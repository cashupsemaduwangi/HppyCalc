<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>HPPyCalc Pro - Smart COGS Calculator</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html-docx-js@0.3.1/dist/html-docx.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

    <style>
      :root {
        --glass-bg: rgba(255, 255, 255, 0.7);
        --glass-border: rgba(255, 255, 255, 0.3);
      }

      body {
        font-family: "Inter", sans-serif;
        background: linear-gradient(135deg, #f0f4f8 0%, #d9e2ec 100%);
        min-height: 100vh;
      }

      .glass-card {
        background: var(--glass-bg);
        backdrop-filter: blur(10px);
        border: 1px solid var(--glass-border);
        border-radius: 1.25rem;
        box-shadow: 0 8px 32px rgba(31, 38, 135, 0.07);
      }

      .step-dot.active {
        background-color: #3b82f6;
        box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2);
      }
      .step-line.active {
        background-color: #3b82f6;
      }

      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }

      /* LOGIKA NAVBAR RESPONSIF */
      @media (min-width: 768px) {
        .mobile-nav {
          display: none !important;
        }
        body {
          padding-bottom: 0;
        }
      }

      @media (max-width: 767px) {
        .desktop-header {
          display: none !important;
        }
        body {
          padding-bottom: 5rem; /* Ruang untuk nav bawah di HP */
        }
      }

      /* ==========================================
         PEMBARUAN CSS CETAK (PRINT) RESPONSIVE
         ========================================== */
      @media print {
        /* 1. Sembunyikan elemen UI non-data */
        button,
        .mobile-nav,
        .desktop-header,
        .ph-arrows-counter-clockwise {
          display: none !important;
        }

        /* 2. Reset Container agar Elastis (Muat di A4/Letter/F4) */
        #hasil-perhitungan {
          display: block !important;
          width: 100% !important;
          max-width: 100% !important;
          margin: 0 !important;
          padding: 10px !important;
          background: white !important;
        }

        /* 3. Paksa Grid 2 Kolom (HPP & Total Biaya) agar tidak bertumpuk */
        .grid {
          display: flex !important;
          flex-wrap: nowrap !important;
          gap: 15px !important;
          width: 100% !important;
        }

        .grid > div {
          flex: 1 1 50% !important;
          max-width: 50% !important;
          box-sizing: border-box !important;
        }

        /* 4. Paksa Kartu AI tetap 3 Kolom ke samping */
        #ai-cards-container {
          display: flex !important;
          flex-direction: row !important;
          flex-wrap: nowrap !important;
          gap: 10px !important;
          justify-content: space-between !important;
        }

        #ai-cards-container > div {
          flex: 1 1 33% !important;
          max-width: 33% !important;
          font-size: 10px !important;
        }

        /* 5. Desain Kartu Bersih & Tanpa Potongan Halaman */
        .glass-card {
          background: white !important;
          box-shadow: none !important;
          border: 1px solid #e2e8f0 !important;
          page-break-inside: avoid;
          break-inside: avoid;
          padding: 20px !important;
          border-radius: 12px !important;
          margin-bottom: 15px !important;
        }

        /* 6. Optimasi Grafik (Canvas) */
        canvas {
          width: 100% !important;
          height: auto !important;
          max-height: 250px !important;
          display: block !important;
          margin: 0 auto !important;
        }

        /* 7. Penyesuaian Warna untuk Printer */
        .bg-blue-600 {
          background-color: #2563eb !important;
          color: white !important;
          -webkit-print-color-adjust: exact;
          print-color-adjust: exact;
        }
        #pdf-template {
          width: 210mm; /* Standar A4 */
          min-height: 297mm;
          padding: 15mm;
          background: white;
          font-family: Arial, sans-serif;
          color: #333;
          box-sizing: border-box;
        }

        /* Mencegah pemotongan di tengah elemen penting */
        .pdf-section {
          page-break-inside: avoid;
          margin-bottom: 10px;
        }
      }
    </style>
  </head>
  <body class="text-slate-800">
    <header
      class="desktop-header flex items-center justify-between px-8 py-4 bg-white/50 backdrop-blur-md sticky top-0 z-40 border-b border-slate-200"
    >
      <div class="flex items-center gap-2">
        <div
          class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-blue-200"
        >
          <i class="ph-fill ph-calculator text-2xl"></i>
        </div>
        <h1 class="text-xl font-bold tracking-tight text-slate-900">
          HPPyCalc<span class="text-blue-600">Pro</span>
        </h1>
      </div>
      <nav>
        <ul class="flex gap-6 text-sm font-medium">
          <li>
            <button
              onclick="showSection('kalkulator')"
              class="text-slate-600 hover:text-blue-700 transition"
            >
              Dashboard
            </button>
          </li>
          <li>
            <button
              onclick="showSection('riwayat')"
              class="text-slate-500 hover:text-blue-600 transition"
            >
              History
            </button>
          </li>
          <li>
            <button
              onclick="showSection('tentang')"
              class="text-slate-500 hover:text-blue-600 transition"
            >
              Info
            </button>
          </li>
        </ul>
      </nav>
    </header>

    <main class="max-w-4xl mx-auto p-4 md:p-8">
      <section id="kalkulator" class="active-section space-y-6">
        <div class="flex justify-between items-end">
          <div>
            <h2 class="text-2xl font-bold text-slate-900">Kalkulator HPP</h2>
            <p class="text-slate-500 text-sm">
              Ikuti langkah berikut untuk menghitung harga pokok.
            </p>
          </div>
          <button
            onclick="resetForm()"
            class="p-2 text-slate-400 hover:text-red-500 transition"
          >
            <i class="ph ph-arrows-counter-clockwise text-xl"></i>
          </button>
        </div>

        <div
          class="flex items-center justify-between px-4 py-2 bg-white rounded-2xl border border-slate-100 shadow-sm"
        >
          <div class="flex flex-col items-center gap-1">
            <div
              id="dot-1"
              class="step-dot w-3 h-3 rounded-full bg-slate-200 active"
            ></div>
            <span class="text-[10px] font-bold text-slate-400">PRODUK</span>
          </div>
          <div class="step-line flex-1 h-[2px] bg-slate-100 mx-2 active"></div>
          <div class="flex flex-col items-center gap-1">
            <div
              id="dot-2"
              class="step-dot w-3 h-3 rounded-full bg-slate-200"
            ></div>
            <span class="text-[10px] font-bold text-slate-400">BIAYA</span>
          </div>
          <div class="step-line flex-1 h-[2px] bg-slate-100 mx-2"></div>
          <div class="flex flex-col items-center gap-1">
            <div
              id="dot-3"
              class="step-dot w-3 h-3 rounded-full bg-slate-200"
            ></div>
            <span class="text-[10px] font-bold text-slate-400">FINISH</span>
          </div>
        </div>

        <form id="hpp-form">
          <div id="step-1" class="wizard-step space-y-4">
            <div class="glass-card p-6 space-y-4">
              <div class="space-y-2">
                <label class="text-sm font-semibold flex items-center gap-2">
                  <i class="ph ph-package text-blue-500"></i> Nama Produk
                </label>
                <input
                  type="text"
                  id="productName"
                  placeholder="Contoh: Brownies Panggang"
                  class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition"
                  required
                />
              </div>
              <div class="space-y-2">
                <label class="text-sm font-semibold flex items-center gap-2">
                  <i class="ph ph-hash text-blue-500"></i> Jumlah Unit Produksi
                </label>
                <input
                  type="number"
                  id="jumlahUnit"
                  placeholder="0"
                  class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition"
                  required
                />
              </div>
            </div>
            <button
              type="button"
              onclick="nextStep(2)"
              class="w-full py-4 bg-blue-600 text-white rounded-2xl font-bold shadow-lg shadow-blue-200 hover:bg-blue-700 active:scale-[0.98] transition flex items-center justify-center gap-2"
            >
              Lanjut ke Biaya <i class="ph ph-arrow-right"></i>
            </button>
          </div>

          <div id="step-2" class="wizard-step hidden space-y-4">
            <div class="glass-card p-6">
              <h3
                class="text-sm font-bold uppercase tracking-wider text-slate-400 mb-4 flex justify-between"
              >
                Bahan Baku
                <span id="totalBahanBakuDisplay" class="text-blue-600 font-bold"
                  >Rp 0</span
                >
              </h3>
              <div id="bahanBakuContainer" class="space-y-3"></div>
              <button
                type="button"
                onclick="addItemRow('bahanBaku', 'BB')"
                class="mt-4 w-full py-2 border-2 border-dashed border-slate-200 rounded-xl text-slate-500 text-sm font-medium hover:bg-white transition flex items-center justify-center gap-2"
              >
                <i class="ph ph-plus-circle"></i> Tambah Bahan
              </button>
            </div>

            <div class="glass-card p-6 space-y-4">
              <div class="space-y-2">
                <label class="text-sm font-semibold flex items-center gap-2">
                  <i class="ph ph-users text-blue-500"></i> Total Biaya Tenaga
                  Kerja
                </label>
                <input
                  type="number"
                  id="biayaTenagaKerja"
                  placeholder="Rp 0"
                  class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-blue-500 outline-none transition"
                />
              </div>
              <hr class="border-slate-100" />
              <h3
                class="text-sm font-bold uppercase tracking-wider text-slate-400 flex justify-between"
              >
                Biaya Overhead
                <span id="totalLainLainDisplay" class="text-blue-600 font-bold"
                  >Rp 0</span
                >
              </h3>
              <div id="biayaLainLainContainer" class="space-y-3"></div>
              <button
                type="button"
                onclick="addItemRow('biayaLainLain', 'BOP')"
                class="w-full py-2 border-2 border-dashed border-slate-200 rounded-xl text-slate-500 text-sm font-medium hover:bg-white transition flex items-center justify-center gap-2"
              >
                <i class="ph ph-plus-circle"></i> Tambah Biaya Lain
              </button>
            </div>

            <div class="flex gap-3">
              <button
                type="button"
                onclick="nextStep(1)"
                class="flex-1 py-4 bg-white text-slate-600 border border-slate-200 rounded-2xl font-bold transition"
              >
                Kembali
              </button>
              <button
                type="submit"
                class="flex-[2] py-4 bg-blue-600 text-white rounded-2xl font-bold shadow-lg shadow-blue-200 hover:bg-blue-700 transition"
              >
                Hitung HPP Sekarang
              </button>
            </div>
          </div>
        </form>

        <div id="hasil-perhitungan" class="wizard-step hidden space-y-6">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div
              class="glass-card p-6 bg-blue-600 text-white relative overflow-hidden"
            >
              <i
                class="ph ph-tag text-white/20 text-7xl absolute -right-4 -bottom-4"
              ></i>
              <p class="text-sm text-blue-100 font-medium">HPP per Unit</p>
              <h2 id="outputHPPUnit" class="text-3xl font-bold mt-1">Rp 0</h2>
            </div>
            <div class="glass-card p-6 bg-white border-blue-100">
              <p class="text-sm text-slate-500 font-medium">
                Total Biaya Produksi
              </p>
              <h2
                id="outputTotalBiaya"
                class="text-3xl font-bold text-slate-900 mt-1"
              >
                Rp 0
              </h2>
            </div>
          </div>

          <div class="glass-card p-6 space-y-4">
            <h3 class="font-bold text-slate-800">Analisis Harga Jual</h3>
            <div class="flex items-center gap-3">
              <div class="flex-1">
                <label class="text-[10px] font-bold text-slate-400 uppercase"
                  >Margin Laba (%)</label
                >
                <input
                  type="number"
                  id="marginLaba"
                  value="20"
                  class="w-full px-4 py-2 bg-slate-50 rounded-lg outline-none focus:ring-2 focus:ring-blue-500"
                />
              </div>
              <button
                onclick="hitungHargaJual()"
                class="h-10 px-6 mt-4 bg-orange-500 text-white rounded-lg font-bold text-sm hover:bg-orange-600 transition"
              >
                Update
              </button>
            </div>

            <div
              id="wrapperSaranManual"
              class="hidden p-4 bg-orange-50 rounded-xl border border-orange-100"
            >
              <p class="text-xs text-orange-600 font-bold uppercase">
                Saran Harga Jual (<span id="marginPersenOutput">0</span>%)
              </p>
              <p
                id="outputHargaJual"
                class="text-2xl font-black text-orange-700"
              >
                Rp 0
              </p>
            </div>

            <div
              id="ai-insight-section"
              class="hidden mt-4 pt-4 border-t border-slate-100 space-y-3"
            >
              <div class="flex items-center gap-2 mb-2">
                <i class="ph-fill ph-sparkle text-purple-600"></i>
                <h4 class="text-sm font-bold text-slate-700 uppercase">
                  AI Smart Pricing
                </h4>
              </div>
              <div
                class="grid grid-cols-1 md:grid-cols-3 gap-3"
                id="ai-cards-container"
              ></div>
            </div>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="glass-card p-6">
              <h3 class="text-sm font-bold text-slate-500 mb-4 uppercase">
                Struktur Biaya
              </h3>
              <div class="h-48"><canvas id="donutChart"></canvas></div>
            </div>
            <div class="glass-card p-6">
              <h3 class="text-sm font-bold text-slate-500 mb-4 uppercase">
                Tren Alokasi Biaya
              </h3>
              <div class="h-48"><canvas id="lineChart"></canvas></div>
            </div>
          </div>

          <div class="flex gap-2">
            <button
              onclick="simpanKeRiwayat(dataHasil)"
              class="flex-1 py-3 bg-emerald-500 text-white rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-emerald-600 transition shadow-lg"
            >
              <i class="ph ph-floppy-disk"></i> Simpan ke Histori
            </button>
            <button
              onclick="exportToWord()"
              class="btn-save flex-1 py-3 bg-blue-500 text-white rounded-xl font-bold flex items-center justify-center gap-2 hover:bg-emerald-600 transition shadow-lg"
            >
              <i class="ph ph-file-doc"></i> Simpan ke Word
            </button>
          </div>
        </div>
      </section>

      <section id="riwayat" class="hidden space-y-6">
        <div class="flex justify-between items-center">
          <div>
            <h2 class="text-2xl font-bold text-slate-900">
              Riwayat Perhitungan
            </h2>
            <p class="text-slate-500 text-sm">
              Data perhitungan 10 produk terakhir Anda.
            </p>
          </div>
          <button
            onclick="hapusSemuaRiwayat()"
            class="text-xs font-bold text-red-500 hover:text-red-700 transition flex items-center gap-1"
          >
            <i class="ph ph-trash"></i> Bersihkan
          </button>
        </div>

        <div id="riwayat-list" class="grid grid-cols-1 gap-4">
          <div
            class="text-center py-20 bg-white/50 rounded-3xl border-2 border-dashed border-slate-200"
          >
            <i class="ph ph-folder-open text-5xl text-slate-200 mb-2"></i>
            <p class="text-slate-400">Belum ada data tersimpan</p>
          </div>
        </div>
      </section>

      <section id="tentang" class="hidden space-y-6">
        <h2 class="text-2xl font-bold text-slate-900">Tentang HPPyCalc Pro</h2>
        <div class="glass-card p-6 space-y-4 text-slate-600 leading-relaxed">
          <p>
            Aplikasi kalkulator biaya produksi pintar untuk membantu UMKM
            menghitung harga jual yang lebih kompetitif dan akurat.
          </p>
          <div class="grid grid-cols-2 gap-4 text-sm font-medium">
            <div class="p-4 bg-blue-50 rounded-2xl text-blue-700">
              Pricing Analysis With AI
            </div>
            <div class="p-4 bg-orange-50 rounded-2xl text-orange-700">
              User friendly interface
            </div>
            <div class="p-4 bg-emerald-50 rounded-2xl text-emerald-700">
              Word File Reporting
            </div>
            <div class="p-4 bg-purple-50 rounded-2xl text-purple-700">
              Visual Insights
            </div>
          </div>
        </div>
      </section>
    </main>

    <nav
      class="mobile-nav fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-lg border-t border-slate-200 flex justify-around items-center py-3 px-6 z-50"
    >
      <button
        onclick="showSection('kalkulator')"
        class="flex flex-col items-center gap-1 text-blue-600"
      >
        <i class="ph-fill ph-house text-2xl"></i>
        <span class="text-[10px] font-bold uppercase">Home</span>
      </button>
      <button
        onclick="showSection('riwayat')"
        class="flex flex-col items-center gap-1 text-slate-400"
      >
        <i class="ph ph-clock-counter-clockwise text-2xl"></i>
        <span class="text-[10px] font-bold uppercase">History</span>
      </button>
      <button
        onclick="showSection('tentang')"
        class="flex flex-col items-center gap-1 text-slate-400"
      >
        <i class="ph ph-info text-2xl"></i>
        <span class="text-[10px] font-bold uppercase">About</span>
      </button>
    </nav>
    <div
      id="pdf-template"
      style="
        display: none;
        width: 210mm;
        background: white;
        padding: 10mm 15mm;
        font-family: Arial, sans-serif;
        color: #222;
        box-sizing: border-box;
      "
    >
      <div
        style="
          text-align: center;
          border-bottom: 2pt solid #222;
          padding-bottom: 10px;
          margin-bottom: 20px;
        "
      >
        <h1 style="margin: 0; font-size: 18pt; text-transform: uppercase">
          Laporan Harga Pokok Produksi
        </h1>
        <p style="margin: 5px 0 0 0; font-size: 10pt; color: #666">
          Dicetak Otomatis via HPPyCalc Pro [cite: 2]
        </p>
      </div>

      <table style="width: 100%; margin-bottom: 20px; font-size: 11pt">
        <tr>
          <td style="width: 40%"><strong>Nama Produk</strong></td>
          <td>: <span id="pdf-nama">Kue Cokelat Premium</span> [cite: 3]</td>
        </tr>
        <tr>
          <td><strong>Tanggal Laporan</strong></td>
          <td>: <span id="pdf-tgl">24 Februari 2026</span> [cite: 3]</td>
        </tr>
      </table>

      <div style="margin-bottom: 25px">
        <div
          style="
            background: #f0f0f0;
            padding: 5px 10px;
            font-weight: bold;
            font-size: 12pt;
            margin-bottom: 10px;
          "
        >
          1. RINCIAN BIAYA PRODUKSI [cite: 4]
        </div>
        <table style="width: 100%; border-collapse: collapse; font-size: 11pt">
          <tr style="border-bottom: 1px solid #ddd">
            <td style="padding: 8px 0">Biaya Bahan Baku</td>
            <td id="pdf-bahan" style="text-align: right; padding: 8px 0">
              Rp 100.000 [cite: 5]
            </td>
          </tr>
          <tr style="border-bottom: 1px solid #ddd">
            <td style="padding: 8px 0">Biaya Tenaga Kerja</td>
            <td id="pdf-tenaga" style="text-align: right; padding: 8px 0">
              Rp 300.000 [cite: 5]
            </td>
          </tr>
          <tr style="border-bottom: 1px solid #ddd">
            <td style="padding: 8px 0">Biaya Overhead</td>
            <td id="pdf-overhead" style="text-align: right; padding: 8px 0">
              Rp 0 [cite: 5]
            </td>
          </tr>
          <tr style="font-weight: bold; font-size: 12pt; background: #fff">
            <td style="padding: 12px 0">Total Biaya Produksi</td>
            <td id="pdf-total" style="text-align: right; padding: 12px 0">
              Rp 400.000 [cite: 5]
            </td>
          </tr>
        </table>
      </div>

      <div style="margin-bottom: 25px">
        <div
          style="
            background: #f0f0f0;
            padding: 5px 10px;
            font-weight: bold;
            font-size: 12pt;
            margin-bottom: 10px;
          "
        >
          2. ANALISIS HARGA JUAL
        </div>
        <table style="width: 100%; border-collapse: collapse; font-size: 11pt">
          <tr>
            <td style="width: 50%; padding: 5px 0">Kuantitas Produksi</td>
            <td id="pdf-qty" style="text-align: right">50 Unit</td>
          </tr>
          <tr>
            <td style="padding: 5px 0">HPP per Unit</td>
            <td
              id="pdf-hpp-unit"
              style="text-align: right; color: #d32f2f; font-weight: bold"
            >
              Rp 8.000
            </td>
          </tr>
          <tr>
            <td style="padding: 5px 0">Margin Keuntungan</td>
            <td id="pdf-margin" style="text-align: right">20%</td>
          </tr>
          <tr style="font-weight: bold; font-size: 13pt; color: #2e7d32">
            <td style="padding: 10px 0; border-top: 2px solid #222">
              Saran Harga Jual
            </td>
            <td
              id="pdf-saran-harga"
              style="text-align: right; border-top: 2px solid #222"
            >
              Rp 9.600
            </td>
          </tr>
        </table>
      </div>

      <div
        style="
          border: 1px solid #ddd;
          padding: 15px;
          border-radius: 4px;
          background-color: #fafafa;
        "
      >
        <div
          style="
            font-weight: bold;
            font-size: 10pt;
            color: #444;
            margin-bottom: 10px;
            text-transform: uppercase;
          "
        >
          Strategi Penetapan Harga (AI Recommendation)
        </div>
        <div
          style="
            font-size: 9pt;
            line-height: 1.4;
            text-align: justify;
            color: #555;
          "
        >
          <p style="margin: 0 0 5px 0">
            <strong>Penetrasi:</strong> <span id="pdf-ai-penetration">-</span>
          </p>
          <p style="margin: 0 0 5px 0">
            <strong>Value-Based:</strong> <span id="pdf-ai-value">-</span>
          </p>
          <p style="margin: 0">
            <strong>Premium:</strong> <span id="pdf-ai-premium">-</span>
          </p>
        </div>
      </div>

      <div style="margin-top: 40px">
        <table style="width: 100%">
          <tr>
            <td style="width: 60%"></td>
            <td style="text-align: center; font-size: 10pt">
              <p style="margin-bottom: 50px">Pemilik Usaha,</p>
              <p style="margin: 0; font-weight: bold">
                ( ____________________ )
              </p>
            </td>
          </tr>
        </table>
      </div>
    </div>
    <script src="script.js"></script>
  </body>
</html>
